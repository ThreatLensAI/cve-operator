# CSYE7125 Kubernetes Operator - CVE Operator

This repo contains code for a Kubernetes Operator that scans a given GitHub repository for releases. It scans the releases and creates custom jobs to process them. The operator is built using Kubebuilder and is written in Go.

## Prerequisites

- Go version 1.22.3 or later. [Download link](https://golang.org/dl/)
- Docker installed and running. [Download link](https://docs.docker.com/get-docker/)
- Kubernetes cluster running locally (e.g., using Minikube) or remotely.
- Kubectl installed. [Install kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/)
- Helm installed. [Install Helm](https://helm.sh/docs/intro/install/)

## Project Structure

- `internal/controller/` - Controller logic for the operator
  - `githubrelease_controller.go` - Controller (Reconciler) logic to process each GitHub Release.
  - `githubreleasemonitor_controller.go` - Controller (Reconciler) logic to monitor GitHub Releases.
- `config/` - Contains the configuration for the operator.
- `api/v1/` - The API definitions for the custom resources.
- `charts/` - The Helm chart for the operator and application.
  - `helm-cve-operator` - The Helm chart for the operator.
  - `helm-cve-operator-app` - The Helm chart for the CVE operator application.

## Build and Deploy Instructions

### Development

1. Clone the repository.
2. Make sure you have kubectl installed and configured to the cluster you want to deploy the operator to.
3. Install the custom crds on the kubernetes cluster using the following command

  ```bash
  make install
  ```

#### Apply CRD

1. Apply a sample CRD to the cluster:

```bash
kubectl apply -f config/samples/github_v1_githubreleasesmonitor.yaml
```

#### Debug

Debug the operator locally by running the VS Code debugger. The `launch.json` file contains the configuration for the debugger.

#### Run

Run the operator locally:

```bash
make run
```

### Deploy

Deploy controller with custom controller/cve-operator image to the K8s cluster specified in ~/.kube/config using the following command:

```bash
make deploy IMG=<your-image-name>
```
