# CSYE7125 Helm Chart to deploy CVE Operator app

This repository contains Helm chart designed to deploy custom crds `githubreleasemonitor` on Kubernetes cluster.

## Helm Installation

Please follow the installation instructions required for setting up the project [here](INSTALLATION.md).

## Installation

To install the chart with default variables set in `values.yaml`, helm install requires following secrets to be provided.

Following secrets are required:

- `secrets.dockerhubconfigjson` - DockerHub credentials in base64 encoded format.
- `kafka.secrets.username` - Kafka username in base64 encoded format.
- `kafka.secrets.password` - Kafka password in base64 encoded format.
- `kafka.env` - List of kafka configuration environment variables.
- `githubReleasesMonitor.owner` - Github owner to monitor
- `githubReleasesMonitor.repo` - Github repo to monitor

Following Kafka variables are required:

- `KAFKA_BROKERS`
- `KAFKA_TOPIC`

This can be provided in following two ways:

1. Update the `values.yaml` file variable:

    ```yaml
    secrets:
        dockerhub: <base64 encoded dockerhub config/credentials>
    kafka:
        secrets:
            username: <base64 encoded kafka username>
            password: <base64 encoded kafka password>
        env:
            KAFKA_BROKERS: <kafka brokers>
            KAFKA_TOPIC: <kafka topic>
    githubReleasesMonitor:
        owner: ''
        repo: ''
    ```

    and then run the following command:

    ```bash
    helm install cve-processor .
    ```

    This will install the chart with the default values set in `values.yaml` in the `default` namespace.

## Uninstallation

To uninstall the chart, use the following command:

```bash
helm uninstall cve-processor
```

## Configuration

The following table lists the configurable parameters of the chart and their default values.

| Parameter                                                                | Description                                  | Default                           |
| ------------------------------------------------------------------------ | -------------------------------------------- | --------------------------------- |
| `githubReleasesMonitor.owner`                                            | GitHub repository owner                      | `''`                              |
| `githubReleasesMonitor.repo`                                             | GitHub repository name                       | `''`                              |
| `githubReleasesMonitor.monitorFrom`                                      | Monitoring start time                        | `now`                             |
| `githubReleasesMonitor.githubReleaseJob.image.name`                      | Name of the processor image                  | `processor`                       |
| `githubReleasesMonitor.githubReleaseJob.image.repository`                | Repository for the processor image           | `marlapativ/webapp-cve-processor` |
| `githubReleasesMonitor.githubReleaseJob.image.tag`                       | Tag for the processor image                  | `latest`                          |
| `githubReleasesMonitor.githubReleaseJob.image.pullPolicy`                | Image pull policy                            | `Always`                          |
| `githubReleasesMonitor.githubReleaseJob.image.resources.limits.cpu`      | CPU limit for the processor image            | `150m`                            |
| `githubReleasesMonitor.githubReleaseJob.image.resources.limits.memory`   | Memory limit for the processor image         | `128Mi`                           |
| `githubReleasesMonitor.githubReleaseJob.image.resources.requests.cpu`    | CPU request for the processor image          | `100m`                            |
| `githubReleasesMonitor.githubReleaseJob.image.resources.requests.memory` | Memory request for the processor image       | `100Mi`                           |
| `provisioning.enabled`                                                   | Enable provisioning                          | `false`                           |
| `provisioning.image.repository`                                          | Repository for the provisioning image        | `marlapativ/webapp-cve-processor` |
| `provisioning.image.tag`                                                 | Tag for the provisioning image               | `latest`                          |
| `provisioning.image.pullPolicy`                                          | Image pull policy for the provisioning image | `Always`                          |
| `provisioning.resources.limits.cpu`                                      | CPU limit for the provisioning image         | `500m`                            |
| `provisioning.resources.limits.memory`                                   | Memory limit for the provisioning image      | `256Mi`                           |
| `provisioning.resources.requests.cpu`                                    | CPU request for the provisioning image       | `350m`                            |
| `provisioning.resources.requests.memory`                                 | Memory request for the provisioning image    | `100Mi`                           |
| `provisioning.podAnnotations`                                            | Annotations for the provisioning pods        | `{}`                              |
| `provisioning.podLabels`                                                 | Labels for the provisioning pods             | `{}`                              |
| `provisioning.initContainers`                                            | Init containers for the provisioning pods    | `[]`                              |
